!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexshatterimageplugin=e()}(void 0,function(){function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(i=n.key,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(i,"string"))?s:String(s)),n)}var i,s}function t(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&r(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function o(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function h(n){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=s(n);if(i){var r=s(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return o(this,t)}}function i(){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function E(t,e){void 0===e&&(e=!0);var r=c.triangulate(t);if(e){for(var n=[],i=0,s=r.length;i<s;i+=3){var o=t[r[i+0]],a=t[r[i+1]],u=t[r[i+2]],h=new l(o[0],o[1],a[0],a[1],u[0],u[1]);n.push(h)}return n}return{vertices:t,indices:r}}var a,c=(function(t){var e,w;function p(t,e,r,n){var i,s,o,a,u,h,c,l,f,v,y=t[e][0],p=t[e][1],g=t[r][0],d=t[r][1],m=t[n][0],b=t[n][1],P=Math.abs(p-d),x=Math.abs(d-b);if(P<w&&x<w)throw new Error("Eek! Coincident points!");return s=P<w?(a=-(m-g)/(b-d))*((i=(g+y)/2)-(h=(g+m)/2))+(l=(d+b)/2):x<w?(o=-(g-y)/(d-p))*((i=(m+g)/2)-(u=(y+g)/2))+(c=(p+d)/2):(i=((o=-(g-y)/(d-p))*(u=(y+g)/2)-(a=-(m-g)/(b-d))*(h=(g+m)/2)+(l=(d+b)/2)-(c=(p+d)/2))/(o-a),x<P?o*(i-u)+c:a*(i-h)+l),{i:e,j:r,k:n,x:i,y:s,r:(f=g-i)*f+(v=d-s)*v}}function g(t){var e,r,n,i,s,o;for(r=t.length;r;)for(i=t[--r],n=t[--r],e=r;e;)if(o=t[--e],n===(s=t[--e])&&i===o||n===o&&i===s){t.splice(r,2),t.splice(e,2);break}}w=1/1048576,e={triangulate:function(r,t){var e,n,i,s,o,a,u,h,c,l,f,v,y=r.length;if(y<3)return[];if(r=r.slice(0),t)for(e=y;e--;)r[e]=r[e][t];for(i=new Array(y),e=y;e--;)i[e]=e;for(i.sort(function(t,e){return r[e][0]-r[t][0]}),s=function(t){var e,r,n,i,s,o,a=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(e=t.length;e--;)t[e][0]<a&&(a=t[e][0]),t[e][0]>h&&(h=t[e][0]),t[e][1]<u&&(u=t[e][1]),t[e][1]>c&&(c=t[e][1]);return n=c-u,[[(s=a+.5*(r=h-a))-20*(i=Math.max(r,n)),(o=u+.5*n)-i],[s,o+20*i],[s+20*i,o-i]]}(r),r.push(s[0],s[1],s[2]),o=[p(r,y+0,y+1,y+2)],a=[],u=[],e=i.length;e--;u.length=0){for(v=i[e],n=o.length;n--;)0<(h=r[v][0]-o[n].x)&&h*h>o[n].r?(a.push(o[n]),o.splice(n,1)):h*h+(c=r[v][1]-o[n].y)*c-o[n].r>w||(u.push(o[n].i,o[n].j,o[n].j,o[n].k,o[n].k,o[n].i),o.splice(n,1));for(g(u),n=u.length;n;)f=u[--n],l=u[--n],o.push(p(r,l,f,v))}for(e=o.length;e--;)a.push(o[e]);for(o.length=0,e=a.length;e--;)a[e].i<y&&a[e].j<y&&a[e].k<y&&o.push(a[e].i,a[e].j,a[e].k);return o},contains:function(t,e){if(e[0]<t[0][0]&&e[0]<t[1][0]&&e[0]<t[2][0]||e[0]>t[0][0]&&e[0]>t[1][0]&&e[0]>t[2][0]||e[1]<t[0][1]&&e[1]<t[1][1]&&e[1]<t[2][1]||e[1]>t[0][1]&&e[1]>t[1][1]&&e[1]>t[2][1])return null;var r=t[1][0]-t[0][0],n=t[2][0]-t[0][0],i=t[1][1]-t[0][1],s=t[2][1]-t[0][1],o=r*s-n*i;if(0==o)return null;var a=(s*(e[0]-t[0][0])-n*(e[1]-t[0][1]))/o,u=(r*(e[1]-t[0][1])-i*(e[0]-t[0][0]))/o;return a<0||u<0||1<a+u?null:[a,u]}},t.exports=e}(a={exports:{}}),a.exports),l=Phaser.Geom.Triangle,V=Phaser.Utils.Objects.GetValue,C=Phaser.Math.Clamp,L=[1/27,3/27,9/27],U=function(t,e,r,n,i,s,o,a,u,h,c,l){var f=[];f.push([t,e]);for(var v=Math.min(r,n),y=0,p=i.length;y<p;y++)g(f,t,e,v*i[y],s,o,a,u,h,c,l);v=2*Math.max(r,n);return g(f,t,e,v,s,o,a,u,h,c,l),f},p=2*Math.PI,g=function(t,e,r,n,i,s,o,a,u,h,c){for(var l=0;l<i;l++){var f=l/i*p,v=e+Math.cos(f)*n*d(s,o),y=r+Math.sin(f)*n*d(s,o);v=C(v,a,u),y=C(y,h,c),t.push([v,y])}return t},d=function(t,e){return t===e?t:t+(e-t)*Math.random()},v=Phaser.Geom.Mesh.Face,y=Phaser.Math.DegToRad,m=Phaser.Math.RadToDeg,b=Phaser.Geom.Mesh.RotateFace,A=function(){e(s,v);var i=h(s);function s(t,e,r){var n;return f(this,s),(n=i.call(this,t,e,r))._rotation=0,n}return t(s,[{key:"rotation",get:function(){return this._rotation},set:function(t){b(this,t-this._rotation),this._rotation=t}},{key:"setRotation",value:function(t){return this.rotation=t,this}},{key:"angle",get:function(){return m(this.rotation)},set:function(t){this.rotation=y(t)}},{key:"setAngle",value:function(t){return this.angle=t,this}},{key:"setAlpha",value:function(t){return this.alpha=t,this}},{key:"tint",get:function(){var t=this.vertex1.color,e=this.vertex2.color,r=this.vertex3.color;return(((t>>0&255)+(e>>0&255)+(r>>0&255))/3<<0)+(((t>>8&255)+(e>>8&255)+(r>>8&255))/3<<8)+(((t>>16&255)+(e>>16&255)+(r>>16&255))/3<<16)},set:function(t){this.vertex1.color=t,this.vertex2.color=t,this.vertex3.color=t}},{key:"setTint",value:function(t){return this.tint=t,this}}]),s}(),D=Phaser.Math.RotateAround,F={x:0,y:0},P=Phaser.GameObjects.Mesh,Y=Phaser.Utils.Objects.IsPlainObject,x=Phaser.Utils.Objects.GetValue,w=Phaser.Geom.Mesh.GenerateGridVerts,B=Phaser.Geom.Mesh.Vertex,W=Phaser.Math.Distance.Squared,O=[1/27,3/27,9/27],j=function(){e(u,P);var a=h(u);function u(t,e,r,n,i,s){var o;return f(this,u),Y(e)&&(e=x(s=e,"x",0),r=x(s,"y",0),n=x(s,"key",null),i=x(s,"frame",null)),(o=a.call(this,t,e,r,n,i)).type="rexShatterImage",o.hideCCW=!1,o.resetImage(),o.shatterCenter={x:null,y:null},o.setRingRadiusList(x(s,"ringRadiusList",O)),o.setSamplesPerRing(x(s,"samplesPerRing",12)),o.setVariation(x(s,"variation",.25)),o}return t(u,[{key:"setRingRadiusList",value:function(t){return this.ringRadiusList=t,this}},{key:"setSamplesPerRing",value:function(t){return this.samplesPerRing=t,this}},{key:"setVariation",value:function(t){return this.variation=t,this}},{key:"resetImage",value:function(){return this.setSizeToFrame(),this.clear(),this.dirtyCache[9]=-1,w({mesh:this,texture:this.texture.key,frame:this.frame.name,width:this.frame.cutWidth/this.height,height:this.frame.cutHeight/this.height}),this.setOrtho(this.width/this.height,1),this}},{key:"shatter",value:function(t,e,r){if(Y(t)&&(r=t,e=t=void 0),Y(r)&&(r.hasOwnProperty("centerX")&&(t=r.centerX),r.hasOwnProperty("centerY")&&(e=r.centerY),r.hasOwnProperty("ringRadiusList")&&this.setRingRadiusList(r.ringRadiusList),r.hasOwnProperty("samplesPerRing")&&this.setSamplesPerRing(r.samplesPerRing),r.hasOwnProperty("variation")&&this.setVariation(r.variation)),void 0===t)t=this.width/2,e=this.height/2;else{var n=(s=t,o=e,a=(i=this).width/2,u=i.height/2,F.x=s-i.x,F.y=o-i.y,F.x/=i.scaleX,F.y/=i.scaleY,D(F,0,0,-i.rotation),F.x+=a,F.y+=u,F);t=n.x,e=n.y}var i,s,o,a,u;if(this.shatterCenter.x=t,this.shatterCenter.y=e,this.clear(),this.dirtyCache[9]=-1,0===this.width||0===this.height)return this;for(var h=function(t){var e,r,n,i,s,o,a=t.rectangle;o=a?(e=a.x,n=a.y,s=a.width,a.height):(n=e=0,s=t.width,t.height),r=e+s,i=n+o;var u,h,c=t.center;h=void 0===c?(u=(e+r)/2,(n+i)/2):(u=C(c.x,e,r),C(c.y,n,i));var l,f=V(t,"ringRadiusList",L),v=V(t,"samplesPerRing",12),y=V(t,"variation",.25),p=V(t,"triangleOutput",!0);(l=f)&&"function"==typeof l&&(f=f(s,o));for(var g=1-y,d=1+y,m=0;m<10;m++)try{var b=U(u,h,s,o,f,v,g,d,e,r,n,i);return E(b,p)}catch(t){}throw new Error("Generate triangles fail")}({width:this.width,height:this.height,center:this.shatterCenter,triangleOutput:!1,ringRadiusList:this.ringRadiusList,variation:this.variation,samplesPerRing:this.samplesPerRing}),c=h.vertices,l=h.indices,f=[],v=this.width,y=this.height,p=this.frame.cutWidth/y/2,g=this.frame.cutHeight/y/2,d=this.frame.u0,m=this.frame.u1,b=this.frame.v0,P=m-d,x=this.frame.v1-b,w=0,O=c.length;w<O;w++){var j=c[w],R=j[0],k=j[1];f.push({g:W(t,e,R,k),x:R/y-p,y:k/y-g,u:d+R/v*P,v:b+k/y*x})}for(w=0,O=l.length;w<O;w+=3){var I=f[l[w+0]],T=f[l[w+1]],G=f[l[w+2]],S=new B(I.x,-I.y,0,I.u,I.v),M=new B(T.x,-T.y,0,T.u,T.v),_=new B(G.x,-G.y,0,G.u,G.v),N=new A(S,M,_);this.vertices.push(S,M,_),this.faces.push(N),N.g=Math.min(I.g,T.g,G.g)}return this.faces.sort(function(t,e){return t.g-e.g}),this}},{key:"startUpdate",value:function(){return this.ignoreDirtyCache=!0,this}},{key:"stopUpdate",value:function(){return this.ignoreDirtyCache=!1,this}},{key:"tint",get:function(){return 0===this.vertices.length?16777215:this.vertices[0].color},set:function(t){for(var e=this.vertices,r=0,n=e.length;r<n;r++)e[r].color=t}},{key:"setTint",value:function(t){return this.tint=t,this}}]),u}();function R(t,e,r,n,i){var s=new j(this.scene,t,e,r,n,i);return this.scene.add.existing(s),s}var k=Phaser.Utils.Objects.GetAdvancedValue,I=Phaser.GameObjects.BuildGameObject;function T(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var r=k(t,"key",null),n=k(t,"frame",null),i=new j(this.scene,0,0,r,n,t);return I(this.scene,i,t),i}var G=Phaser.Textures.DynamicTexture,S=Phaser.Utils.Objects.IsPlainObject,M=Phaser.Utils.Objects.GetValue,_=function(){e(l,j);var c=h(l);function l(t,e,r,n,i,s){var o;f(this,l),S(e)&&(e=M(s=e,"x",0),r=M(s,"y",0),n=M(s,"width",32),i=M(s,"height",32));var a,u,h=(void 0===(a=n)&&(a=2),void 0===(u=i)&&(u=2),new G(t.sys.textures,null,a,u));return(o=c.call(this,t,e,r,h,null,s)).type="rexShatterRenderTexture",o.rt=o.texture,o}return t(l,[{key:"destroy",value:function(t){i(s(l.prototype),"destroy",this).call(this,t),null!==this.rt&&(this.rt.destroy(),this.rt=null)}}]),l}();function N(t,e,r,n,i){var s=new _(this.scene,t,e,r,n,i);return this.scene.add.existing(s),s}var X=Phaser.Utils.Objects.GetAdvancedValue,H=Phaser.GameObjects.BuildGameObject;function q(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var r=X(t,"x",0),n=X(t,"y",0),i=X(t,"width",32),s=X(t,"height",32),o=new _(this.scene,r,n,i,s,t);return H(this.scene,o,t),o}function z(t){return null==t||""===t||0===t.length}function J(t,e,r,n){if(void 0===n&&(n="."),"object"===u(t)){if(z(e)){if(null==r)return;"object"===u(r)&&(t=r)}else{"string"==typeof e&&(e=e.split(n));var i=e.pop();(function(t,e,r){var n=t;if(!z(e)){var i;"string"==typeof e&&(e=e.split("."));for(var s=0,o=e.length;s<o;s++){var a;if(null==n[i=e[s]]||"object"!==u(n[i]))a=s!==o-1||void 0===r?{}:r,n[i]=a;n=n[i]}}return n})(t,e)[i]=r}return t}}var K=function(){e(n,Phaser.Plugins.BasePlugin);var r=h(n);function n(t){var e;return f(this,n),e=r.call(this,t),t.registerGameObject("rexShatterImage",R,T),t.registerGameObject("rexShatterRenderTexture",N,q),e}return t(n,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),n}();return J(window,"RexPlugins.GameObjects.ShatterImage",j),J(window,"RexPlugins.GameObjects.ShatterRenderTexture",_),K});
